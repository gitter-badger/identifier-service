<dom-module id="id-multiplier">

    <template>
        <span class="minus">
            <span class="octicon octicon-dash" on-click="decrement"></span>
        </span>
        <input type="number"
               min="1" 
               autocomplete="on"
               value="{{value::input}}"
               on-change="adaptIdentifierNumber">
        </input>
        <span class="plus">
            <span class="octicon octicon-plus" on-click="increment"></span>
        </span>
    </template>

    <script>
        "use strict";
        HTMLImports.whenReady(function () {

            Polymer({
                is: 'id-multiplier',

                properties: {
                    value:  String
                },

                decrement: function() {
                    if (this.value > 1) {
                        this.value--;
                        var wrappers = document.querySelectorAll('.identifier-wrapper');
                        for (var wrapper of wrappers) {
                            if (wrapper.hasChildNodes()) {
                                wrapper.removeChild(wrapper.lastElementChild);
                            }
                        }
                        this.adaptIdentifierNumber();
                    }
                },

                increment: function() {
                    this.value++;
                    var url = window.location.href;
                    var href = url.split("?")[0].split("#")[0];
                    var notice1 = '<id-value path="';
                    var notice2 = '"></id-value>';
                    var notice = notice1 + href + notice2;
                    var tmp = document.createElement('id-value');
                    tmp.innerHTML = notice;

                    var wrappers = document.querySelectorAll('.identifier-wrapper');
                    for (var wrapper of wrappers) {
                        wrapper.appendChild(tmp);
                    }
                    this.adaptIdentifierNumber();
                },

                adaptIdentifierNumber: function() {
                    var url = window.location.href;
                    var newAdditionalURL = "";
                    var tempArray = url.split("?");
                    var baseURL = tempArray[0].split("#")[0];
                    var aditionalURL = tempArray[1]; 
                    var temp = "";
                    if (aditionalURL) {
                        var parameters = aditionalURL.split("#")[0];
                        var tempArray = parameters.split("&");
                        for (var i in tempArray) {
                            if (tempArray[i].indexOf("quantity") == -1) {
                                newAdditionalURL += temp + tempArray[i];
                                temp = "&";
                            }
                        }
                    }
                    var params = temp + "quantity=" + this.value + "#identifiers";
                    var finalURL = baseURL + "?" + newAdditionalURL + params;
                    window.history.pushState({"quantity": this.value}, "ID Service", finalURL);
                }

              });

        });
    </script>

</dom-module>
